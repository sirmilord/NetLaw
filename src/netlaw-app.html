<link rel="import" href="../bower_components/polymer/polymer-element.html">
<link rel="import" href="../bower_components/app-layout/app-drawer/app-drawer.html">
<link rel="import" href="../bower_components/app-layout/app-drawer-layout/app-drawer-layout.html">
<link rel="import" href="../bower_components/app-layout/app-header/app-header.html">
<link rel="import" href="../bower_components/app-layout/app-header-layout/app-header-layout.html">
<link rel="import" href="../bower_components/app-layout/app-scroll-effects/app-scroll-effects.html">
<link rel="import" href="../bower_components/app-layout/app-toolbar/app-toolbar.html">
<link rel="import" href="../bower_components/app-route/app-location.html">
<link rel="import" href="../bower_components/app-route/app-route.html">
<link rel="import" href="../bower_components/iron-pages/iron-pages.html">
<link rel="import" href="../bower_components/iron-selector/iron-selector.html">
<link rel="import" href="../bower_components/paper-icon-button/paper-icon-button.html">
<link rel="import" href="../bower_components/paper-checkbox/paper-checkbox.html">
<link rel="import" href="../bower_components/iron-collapse/iron-collapse.html">
<link rel="import" href="../bower_components/iron-flex-layout/iron-flex-layout.html">
<link rel="import" href="../bower_components/iron-flex-layout/iron-flex-layout-classes.html">
<link rel="import" href="../bower_components/iron-media-query/iron-media-query.html">
<link href="../bower_components/polymer-grid-layout/polymer-grid-layout.html" rel="import">
<link rel="import" href="../bower_components/paper-styles/demo-pages.html">
<link rel="import" href="../bower_components/iron-demo-helpers/demo-snippet.html">
<link rel="import" href="../bower_components/iron-demo-helpers/demo-pages-shared-styles.html">
<link rel="import" href="../bower_components/paper-menu-button/paper-menu-button.html">
<link rel="import" href="../bower_components/paper-tabs/paper-tabs.html">
<link rel="import" href="../bower_components/paper-tabs/paper-tab.html">
<link rel="import" href="../bower_components/web-animations-js/web-animations-next.min.html">
<link rel="import" href="../bower_components/polymer/lib/elements/dom-repeat.html">
<link rel="import" href="../bower_components/paper-progress/paper-progress.html">
<link rel="import" href="paper-image-upload-button.html">

<link rel="import" href="netlaw-icons.html">
<link rel="import" href="netlaw-logo.html">
<link rel="import" href="netlaw-search.html">
<link rel="import" href="netlaw-search-mobile.html">
<link rel="import" href="netlaw-notification.html">
<link rel="import" href="netlaw-user.html">
<link rel="import" href="netlaw-user-menu.html">
<link rel="import" href="netlaw-dashboard.html">
<link rel="import" href="netlaw-dashboard-form.html">
<link rel="import" href="netlaw-dashboard-mobile.html">
<link rel="import" href="netlaw-topbar.html">
<link rel="import" href="netlaw-mobile-drawer.html">
<link rel="import" href="netlaw-mobile-notification.html">

<link rel="import" href="perfect-scrollbar-styles.html">

<link rel="import" href="netlaw-login.html">

<link rel="import" href="netlaw-smartguide.html">
<link rel="import" href="netlaw-account.html">
<link rel="import" href="netlaw-lifevault.html">
<link rel="import" href="netlaw-contacts.html">
<link rel="import" href="netlaw-find-attorney.html">
<link rel="import" href="netlaw-add-module.html">
<link rel="import" href="netlaw-profile.html">
<link rel="import" href="netlaw-attorney-details.html">
<link rel="import" href="netlaw-contact-details.html">
<link rel="import" href="netlaw-initial-screen.html">
<link rel="import" href="netlaw-view-404.html">
<link rel="import" href="netlaw-star-rating.html">

<link rel="import" href="../bower_components/nlp-api/nlp-api.html">
<script type="module" src="api.js"></script>

<dom-module id="netlaw-app">
  <template>
    <style is="custom-style" include="iron-flex iron-flex-alignment"></style>
    <style>
      :host {
        --app-header-color: #666;
        --app-header-bg: #fff;
        --app-secondary-color: black;
        display: block;
        --app-drawer-width: 100px;
        --iron-icon-width: 32px;
        --iron-icon-height: 32px;
      }

      /*app-header-layout[md] #drawertoggle {*/
      /*display: none;*/
      /*}*/

      app-header {
        color: var(--app-header-color);
        background-color: var(--app-header-bg);
      }

      #contentContainer {
        padding-top: 0 !important;
      }

      .navbar {
        height: auto;
        box-shadow: 0 1px 2px 0 rgba(0, 0, 0, 0.1);
      }

      .drawer-nav {
        margin-top: 80px;
        list-style: none;
        padding-left: 0;
        text-align: center;
        padding-top: 30px;
        display: block;
        width: 100%;
        height: 100%;
        background-color: #01AA50;
      }

      .drawer-nav--mobile {
        margin-top: 0;
        padding-top: 0;
        display: flex;
      }

      .drawer-nav a:after {
        content: '';
        display: block;
        width: 100%;
        height: 1px;
        background-color: #fff;
        opacity: 0.3;
        position: absolute;
        bottom: 0;
        left: 0;
      }

      .drawer-nav a {
        position: relative;
        color: #fff;
        font-size: 12px;
        line-height: 15px;
        padding: 15px 0;
        text-decoration: none;
        display: block;
      }

      .drawer-nav--mobile a {
        flex: 1 1 25%;
        max-width: 25%;
        font-size: 10px;
        padding: 5px 0;
      }

      .drawer-nav a:hover {
        background-color: rgba(0, 0, 0, 0.1);
      }

      .drawer-nav a.iron-selected {
        background: #414142;
      }

      .drawer-nav a.iron-selected:before {
        content: '';
        display: block;
        position: absolute;
        right: -20px;
        top: 50%;
        transform: translateY(-50%);
        width: 0;
        height: 0;
        border-top: 12.5px solid transparent;
        border-left: 20px solid #414142;
        border-bottom: 12.5px solid transparent;
      }

      .drawer-nav--mobile a.iron-selected:before {
        display: none;
      }

      .drawer-nav a iron-icon {
        width: 32px;
        height: 32px;
        margin: 10px auto;
        clear: both;
        display: block;
        background-position: 50% 50%;
        background-repeat: no-repeat;
        background-size: contain;
        vertical-align: middle;
      }

      .drawer-nav--mobile a iron-icon {
        width: 25px;
        height: 25px;
        margin: 1px auto;
      }

      .drawer-nav a iron-icon {
        opacity: 0.5;
      }

      .drawer-nav a.iron-selected iron-icon {
        opacity: 1;
      }

      .navbar-mobile {
        display: flex;
        align-items: center;
        justify-content: space-between;
        height: 50px;
        /*padding-left: 0;*/
        /*padding-right: 0;*/
        --iron-icon-fill-color: #b2b2b2;
        --iron-icon-width: 24px;
        --iron-icon-height: 24px;
        box-shadow: 0 0.5px 0 0 rgba(0, 0, 0, 0.25);
        padding-left: 15px;
        padding-right: 15px;
      }

      .navbar-mobile--drawer {
        justify-content: center;
        position: relative;
        --iron-icon-fill-color: #000;
      }

      .navbar-mobile__toggle {
        position: absolute;
        top: 0;
        right: -40px;
        background-color: #fff;
        height: 50px;
        width: 41px;
        z-index: 100;
        --iron-icon-height: 24px;
        --iron-icon-width: 24px;
        border: 0;
      }

      .navbar-mobile__toggle:focus {
        outline: 0;
      }

      .navbar-mobile__toggle iron-icon {
        --iron-icon-fill-color: #4A4A4A;
      }

      .mobile-layout {
        --app-drawer-width: calc(100% - 40px);
        /*--app-drawer-layout-content-transition: 1s;*/
      }

      .mobile-drawer {
        display: flex;
        flex-direction: column;
        align-items: center;
        font-family: "Lato", sans-serif;
      }

      .mobile-drawer__img {
        margin-top: 35px;
        display: flex;
        justify-content: center;
        align-items: center;
      }

      .mobile-drawer__message {
        color: #4A4A4A;
        font-weight: 900;
        font-size: 20px;
        text-align: center;
        margin-top: 25px;
      }

      .mobile-drawer__name {
        font-size: 20px;
        font-weight: 400;
        color: #0178BD;
        text-decoration: none;
      }

      .mobile-drawer__list {
        width: 200px;
        margin-top: 25px;
        display: flex;
        flex-direction: column;
        margin-left: auto;
        margin-right: auto;
        text-align: center;
        border-top: 1px solid rgba(151, 151, 151, .3);
      }

      .mobile-drawer__link {
        border-bottom: 1px dashed #CAC9CA;
        font-size: 16px;
        color: #4A4A4A;
        text-decoration: none;
        padding-top: 11px;
        padding-bottom: 11px;
      }

      .mobile-drawer__link--out {
        border: 0;
        color: #CAC9CA;
      }

      .mobile-layout[hidden],
      .desktop-layout[hidden] {
        display: none;
      }

      .mobile-layout[login] {
        display: none;
      }

      .desktop-layout[login],
      #drawerLayout[login],
      #drawer[login] {
        /*visibility: hidden;*/
        /*position: relative;*/
        /*z-index: -1;*/
        display: none;
      }

      #drawer[opened] + .desktop-pages {
        margin-left: 0;
      }

      #drawer + .desktop-pages {
        margin-left: -100px;
      }

      .desktop-layout app-header {
        left: 0 !important;
        right: 0 !important;
      }

      netlaw-login[nologin] {
        display: none;
      }

      #mainmenu[show] {
        display: flex;
        width: 100%;
        justify-content: space-between;
        align-items: center;
      }

      #mainmenu {
        display: none;
      }

      .drawer-overlay {
        position: absolute;
        left: 0;
        top: 0;
        width: calc(100% + 20px);
        height: 100%;
        background-color: rgba(255, 255, 255, .95);
        display: none;
        z-index: 10;
      }

      .drawer-overlay--show {
        display: block;
      }

      ul {
        list-style: none;
        margin: 0;
        padding: 0;
      }

      .lifevault__addfolder-dropdown {
        /*min-height: 154px;*/
        width: 137px;
        border: 1px solid #C2C2C2;
        border-radius: 2px;
        background-color: #FFFFFF;
        box-shadow: 0 2px 3px 0 rgba(0, 0, 0, 0.3);
        padding-left: 15px;
        padding-right: 15px;
      }

      .lifevault__addfolder-dropdown li {
        color: #4A4A4A;
        font-size: 14px;
        display: flex;
        padding-top: 8px;
        padding-bottom: 8px;
      }

      .lifevault__addfolder-dropdown iron-icon {
        margin-left: auto;
        --iron-icon-fill-color: #C2C2C2;
      }

      ul.lifevault__addfolder-dropdown > li > iron-icon {
        --iron-icon-width: 20px;
        --iron-icon-height: 20px;
      }

      .lifevault__addfolder-dropdown--sub {
        width: 164px;
      }

      ul.lifevault__addfolder-dropdown--sub > li > iron-icon {
        --iron-icon-height: 16px;
        --iron-icon-width: 16px;
      }

      .btn {
        margin: 0;
        border: none;
        border-radius: 2px;
        overflow: visible;
        font: inherit;
        color: inherit;
        text-transform: none;
        display: inline-block;
        box-sizing: border-box;
        padding: 0 30px;
        vertical-align: middle;
        font-size: 16px;
        line-height: 40px;
        text-align: center;
        text-decoration: none;
        font-weight: 900;
      }

      .btn--back-dash {
        background-color: transparent;
        border: 0;
        padding: 0;
        color: #cdcdcd;
        --iron-icon-width: 20px;
        --iron-icon-height: 20px;
        --iron-icon-fill-color: #979797;
        font-size: 14px;
        font-weight: 400;
      }

      @media (max-width: 767px) {
        app-header-layout {
          background-color: #fff;
        }

        #placeholder .addfolder-dropdown {
          /*min-height: 154px;*/
          width: 137px;
          border: 1px solid #C2C2C2;
          border-radius: 2px;
          background-color: #FFFFFF;
          box-shadow: 0 2px 3px 0 rgba(0, 0, 0, 0.3);
          padding-left: 15px;
          padding-right: 15px;
        }

        #placeholder .addfolder-dropdown li {
          color: #4A90E2;
          font-size: 14px;
          display: flex;
          padding-top: 8px;
          padding-bottom: 8px;
          --iron-icon-width: 15px;
          --iron-icon-height: 15px;
          --iron-icon-fill-color: #4A90E2;
        }

        #placeholder .addfolder-dropdown iron-icon {
          margin-left: auto;
          margin-top: 3px;
        }

        #placeholder .addfolder-dropdown--sub {
          width: 162px;
        }

        #placeholder h3 {
          margin-right: auto;
          margin-left: auto;
          color: #4A4A4A;
          font-size: 17px;
          font-weight: 500;
        }

        #placeholder paper-menu-button {
          padding: 0;
          --iron-icon-fill-color: red;
        }

        #placeholder .lifevault__paper-button {
          width: 35px;
          height: 35px;
          color: #b2b2b2;

        }

        .account__dropdown {
          /*height: 209px;*/
          box-shadow: 0 2px 3px 0 rgba(0, 0, 0, .3);
        }

        .account__dropdown-title {
          color: #4A90E2;
          padding: 12px 22px;
          font-size: 14px;
          background-color: #fff;
        }

        .login-buttons {
          width: 188px;
          display: flex;
          flex-wrap: wrap;
        }

        .login-buttons paper-icon-button {
          flex: 1 1 50%;
          max-width: 50%;
          padding: 20px;
          height: 84px;
          --iron-icon-width: 39px;
          --iron-icon-height: 39px;
          --iron-icon-fill-color: #ffffff;
          --paper-icon-button-ink-color: transparent;
        }

        .login-buttons paper-icon-button[name="googleplus"] {
          background: #FF3624;
        }

        .login-buttons paper-icon-button[name="facebook"] {
          background: #024DAF;
        }

        .login-buttons paper-icon-button[name="linkedin"] {
          background: #0178BD;
        }

        .login-buttons paper-icon-button[name="twitter"] {
          background: #01B8EC;
        }
      }

    </style>

    <app-location route="{{route}}" url-space-regex="^[[rootPath]]"></app-location>
    <app-route route="{{route}}" pattern="/:page" data="{{routeData}}" tail="{{subroute}}"></app-route>

    <iron-media-query query="max-width: 767px" query-matches="{{mobile}}"></iron-media-query>
    <iron-media-query query="max-width: 991px" query-matches="{{tablet}}"></iron-media-query>
    <iron-media-query query="min-width: 768px" query-matches="{{md}}"></iron-media-query>
    <iron-media-query query="min-width: 992px" query-matches="{{lg}}"></iron-media-query>
    <iron-media-query query="min-width: 1200px" query-matches="{{xl}}"></iron-media-query>
    <iron-media-query query="min-width: 1800px" query-matches="{{xxl}}"></iron-media-query>

    <template is="dom-if" if="[[!loggedIn]]">
      <netlaw-login on-logged-in="onLoggedIn"></netlaw-login>
    </template>

    <!--Main content mobile-->
    <template is="dom-if" if="[[mobile]]" restamp>
      <template is="dom-if" if="[[loggedIn]]">
        <app-drawer-layout class="mobile-layout" fullbleed narrow="{{narrow}}">

          <app-drawer id="mobiledrawer" class="mobile-drawer" slot="drawer" swipe-open="[[narrow]]">
            <app-toolbar class="navbar-mobile navbar-mobile--drawer">
              <netlaw-logo class="mobile"></netlaw-logo>
              <button class="navbar-mobile__toggle" drawer-toggle>
                <iron-icon icon="netlaw-icons:menu" drawer-toggle></iron-icon>
              </button>
            </app-toolbar>

            <figure class="mobile-drawer__img">
              <img src="../images/profile.jpg" height="117" width="117" alt="Profile Image">
            </figure>

            <div class="mobile-drawer__message">Welcome Back,<br>
              <a class="mobile-drawer__name" href="javascript:;" drawer-toggle>John Doe</a>
            </div>

            <iron-selector selected="[[page]]" attr-for-selected="name" class="mobile-drawer__list"
                           role="navigation">
              <!--<a class="mobile-drawer__link" name="add-module" href="[[rootPath]]add-module" drawer-toggle>
                Module Market
              </a>-->
              <a class="mobile-drawer__link" name="profile" href="[[rootPath]]profile" drawer-toggle>
                Profile
              </a>
              <a class="mobile-drawer__link" name="account" href="[[rootPath]]account/info" drawer-toggle>
                Account Settings
              </a>
              <a class="mobile-drawer__link" name="smartguide" href="[[rootPath]]smartguide" drawer-toggle>
                Edit SmartGuide Info
              </a>
              <a class="mobile-drawer__link mobile-drawer__link--out" name="logout"
                 href="[[rootPath]]" drawer-toggle on-click="onSignOutClick">
                Log out
              </a>
            </iron-selector>
          </app-drawer>

          <app-header-layout has-scrolling-region>

            <app-header slot="header" condenses="" reveals="" effects="waterfall" fixed>
              <div class="drawer-overlay"></div>
              <div class="navbar-mobile">
                <paper-icon-button class="navbar-menu" icon="netlaw-icons:menu" drawer-toggle
                                   hidden$="[[fullMenu]]"></paper-icon-button>
                <slot name="placeholder" id="placeholder"></slot>
              </div>
              <iron-dropdown id="dropdownmobilenotification" vertical-offset="50" opened="{{notificationOpened}}">
                <netlaw-mobile-notification id="mobilenotification"
                                            slot="dropdown-content"></netlaw-mobile-notification>
              </iron-dropdown>
            </app-header>
            <iron-pages id="pages" selected="[[page]]" attr-for-selected="name" role="main"
                        fallback-selection="initial-screen" on-menu-changed="_onMenuChanged">
              <netlaw-smartguide name="smartguide" route="[[subroute]]" opened="[[notificationOpened]]"></netlaw-smartguide>
              <netlaw-profile name="profile"></netlaw-profile>
              <netlaw-account name="account" route="[[subroute]]"></netlaw-account>
              <netlaw-lifevault name="lifevault" route="[[subroute]]"></netlaw-lifevault>
              <netlaw-contacts name="contacts" route="[[subroute]]"></netlaw-contacts>
              <netlaw-find-attorney name="find-attorney" route="[[subroute]]"></netlaw-find-attorney>
              <netlaw-add-module name="add-module"></netlaw-add-module>
              <netlaw-initial-screen name="initial-screen" opened="[[notificationOpened]]"></netlaw-initial-screen>
              <netlaw-mobile-notification name="mobile-notification"></netlaw-mobile-notification>
              <view-404 name="view-404"></view-404>
            </iron-pages>

          </app-header-layout>

          <netlaw-mobile-drawer opened="{{drawerOpened}}">
            <div class="drawer-overlay"></div>
            <iron-selector selected="[[page]]" attr-for-selected="name"
                           class="drawer-nav drawer-list drawer-nav--mobile"
                           role="navigation">
              <a name="smartguide" href="[[rootPath]]smartguide">
                <iron-icon icon="netlaw-icons:smart-guide" slot="item-icon"></iron-icon>
                SmartGuide
              </a>
              <a name="lifevault" href="[[rootPath]]lifevault">
                <iron-icon icon="netlaw-icons:life-vault" slot="item-icon"></iron-icon>
                LifeVault
              </a>
              <a name="find-attorney" href="[[rootPath]]find-attorney">
                <iron-icon icon="netlaw-icons:find-attorney" slot="item-icon"></iron-icon>
                Find Attorney
              </a>
              <a name="contacts" href="[[rootPath]]contacts">
                <iron-icon icon="netlaw-icons:contacts" slot="item-icon"></iron-icon>
                Contacts
              </a>
            </iron-selector>
          </netlaw-mobile-drawer>

        </app-drawer-layout>
      </template>
    </template>

    <!-- Main content desktop-->
    <template is="dom-if" if="[[!mobile]]" restamp>
      <template is="dom-if" if="[[loggedIn]]">
        <app-header-layout class="desktop-layout" fullbleed narrow="{{narrow}}">

          <app-header slot="header" condenses="" reveals="" effects="waterfall" fixed>
            <div class="drawer-overlay"></div>
            <app-toolbar class="navbar">
              <netlaw-logo></netlaw-logo>
              <netlaw-search></netlaw-search>
              <netlaw-notification></netlaw-notification>
              <netlaw-user></netlaw-user>
              <netlaw-user-menu></netlaw-user-menu>
            </app-toolbar>
          </app-header>

          <app-drawer-layout id="drawerLayout">
            <app-drawer id="drawer" slot="drawer" opened="{{drawerOpened}}">
              <div class="drawer-overlay"></div>
              <iron-selector selected="[[page]]" attr-for-selected="name" class="drawer-nav drawer-list"
                             role="navigation">
                <a name="smartguide" href="[[rootPath]]smartguide/setup">
                  <iron-icon icon="netlaw-icons:smart-guide" slot="item-icon"></iron-icon>
                  SmartGuide
                </a>
                <a name="lifevault" href="[[rootPath]]lifevault">
                  <iron-icon icon="netlaw-icons:life-vault" slot="item-icon"></iron-icon>
                  LifeVault
                </a>
                <a name="contacts" href="[[rootPath]]contacts">
                  <iron-icon icon="netlaw-icons:contacts" slot="item-icon"></iron-icon>
                  Contacts
                </a>
                <a name="find-attorney" href="[[rootPath]]find-attorney">
                  <iron-icon icon="netlaw-icons:find-attorney" slot="item-icon"></iron-icon>
                  Find Attorney
                </a>
                <!--<a name="add-module" href="[[rootPath]]add-module">
                  <iron-icon icon="netlaw-icons:add-module" slot="item-icon"></iron-icon>
                  Add Module
                </a>-->
              </iron-selector>
            </app-drawer>
            <iron-pages class="desktop-pages" selected="[[page]]" attr-for-selected="name" role="main"
                        fallback-selection="initial-screen">
              <netlaw-smartguide name="smartguide" route="[[subroute]]"></netlaw-smartguide>
              <netlaw-profile name="profile"></netlaw-profile>
              <netlaw-account name="account" route="[[subroute]]"></netlaw-account>
              <netlaw-lifevault name="lifevault" route="[[subroute]]"></netlaw-lifevault>
              <netlaw-contacts name="contacts" route="[[subroute]]"></netlaw-contacts>
              <netlaw-find-attorney name="find-attorney" route="[[subroute]]"></netlaw-find-attorney>
              <netlaw-add-module name="add-module"></netlaw-add-module>
              <netlaw-initial-screen name="initial-screen"></netlaw-initial-screen>
              <view-404 name="view-404"></view-404>
            </iron-pages>
          </app-drawer-layout>
        </app-header-layout>
      </template>
    </template>
  </template>

  <script>
      // Gesture events like tap and track generated from touch will not be
      // preventable, allowing for better scrolling performance.
      Polymer.setPassiveTouchGestures(true);

      class NetlawApp extends Polymer.Element {
          static get is() {
              return 'netlaw-app';
          }

          static get properties() {
              return {
                  loggedIn: {type: Boolean, value: false },//() => location.pathname !== "/"
                  drawerOpened: {
                      type: Boolean,
                      value: true,
                  },
                  rootPath: String,
                  route: {type: Object},
                  routeData: Object,
                  page: {
                      type: String,
                      reflectToAttribute: true,
                      //observer: '_pageChanged',
                  },
                  toggleIcon: {
                      type: String
                  },
                  fullMenu: {type: Boolean, value: false},
                  mobile: {
                      type: Boolean, observer(value) {
                          setTimeout(() => this._pageChanged(this.page, this.loggedIn));
                      }
                  },
                  notificationOpened: {
                      type: Boolean,
                      value: false
                  }
              };
          }


          constructor() {
              super();
              window.app = this;
              window.navigate = path => {
                  // console.log("navigating to:", path);
                  window.history.pushState({}, null, `${path || ""}`);
                  //window.history.pushState({}, null, `${this.rootPath}${path || ""}`);
                  //window.location = `${this.rootPath}${path || ""}`;
                  window.dispatchEvent(new CustomEvent('location-changed'));
              };
              this.toggleIcon = 'netlaw-icons:notifications';
          }

          onLoggedIn(e) {
              this.loggedIn = true;
              // Show initial screen on login
              this.page = 'initial-screen';
              //this._pageChanged(this.page);
              //this.dispatchEvent(new CustomEvent("page-changed"));
              // this.shadowRoot.querySelector("app-header-layout")._updateLayoutStates();
          }

          onSignOutClick(e) {
              debugger;
              this.loggedIn = false;
              // Show login screen on logout
              this.page = 'login';
              navigate('login');
              // window.location.href='/';
              window.location.reload(true);

               // api.accounts.logout();
               // this._setSession(null);
               // this.selected = "signin";
          }

          static get observers() {
              return [
                  '_routePageChanged(routeData.page)',
                  '_pageChanged(page, loggedIn)'
              ];
          }

          _routePageChanged(page) {

              if (this.loggedIn === true) this.page = page || 'initial-screen';

              else this.page = page || 'login';

              // if (!this.shadowRoot.querySelector("#pages"))return;
              // let pageSelected = this.shadowRoot.querySelector("#pages").selectedItem;
              // let template = pageSelected && (pageSelected.menu || this.querySelector("#mainmenu"));
              // this._applyMenu(pageSelected, template);
              if (page == "" || page == null || page == "initial-screen") {
                  this.dispatchEvent(new CustomEvent('menu-changed', {
                      bubbles: true,
                      composed: true,
                      detail: this.$.menu
                  }));
              }
          }

          _applyMenu(component, template, full = false) {
              let placeholder = this.shadowRoot.querySelector('#placeholder');
              if (!placeholder) {
                  setTimeout(() => this._applyMenu(component, template, full));
                  return;
              }
              while (placeholder.firstChild) placeholder.removeChild(placeholder.firstChild);

              this.fullMenu = full;
              if (template) {
                  let instance = component instanceof Polymer.Element ? component._stampTemplate(template) : this._stampTemplate(template);
                  placeholder.appendChild(instance);
              }
          }

          _pageChanged(page, loggedIn) {
              if (!this.contentReady) return;
              console.log("app page changed");
              // Load page import on demand. Show 404 page if fails
              const resolvedPageUrl = this.resolveUrl('netlaw-' + page + '.html');
              Polymer.importHref(
                  resolvedPageUrl,
                  null,
                  this._showPage404.bind(this),
                  true);

              let pages = this.shadowRoot.querySelector("iron-pages");
              //console.log(pages,pages && pages.selectedItem);
              if (!pages && loggedIn) setTimeout(() => this._pageChanged(page));
              else if (pages && pages.selectedItem.open) pages.selectedItem.open();
          }

          _showPage404() {
              this.page = 'view-404';
          }


          _onNavigateNotification(e) {
              this.notificationOpened = !this.notificationOpened;
          }

          _onOverlayChanged(e) {
              let overlays = this.shadowRoot.querySelectorAll('.drawer-overlay');

              if (e.detail.display === true) {
                  overlays.forEach(overlay => overlay.classList.add('drawer-overlay--show'));
              } else {
                  overlays.forEach(overlay => overlay.classList.remove('drawer-overlay--show'));
              }
          }

          ready() {
              super.ready();
              this.addEventListener('overlay-display', this._onOverlayChanged);
              this.addEventListener('drawer-changed', this._onDrawerChanged);
              this.addEventListener('mobile-notification', this._onNavigateNotification);
              this.addEventListener('profile-name-changed', this.onProfileNameChange);

              this.contentReady = true;
              Polymer.RenderStatus.afterNextRender(this, () => this._pageChanged(this.page));
          }

          _onMenuChanged(e) {
              let issimple = e.detail instanceof Element;
              this._applyMenu(e.path[0], issimple ? e.detail : e.detail.menu, issimple ? false : e.detail.full);
          }

          _onDrawerChanged(e) {
              //debugger;
              console.log("opened:",e.detail.opened);
              Polymer.RenderStatus.afterNextRender(this, () => this.drawerOpened = e.detail.opened);
          }

          onProfileNameChange(e) {
             let profileName = this.shadowRoot.querySelector("netlaw-user-menu");
             if (profileName) profileName.profileName = e.detail.profileName;
          }
      }

      window.customElements.define(NetlawApp.is, NetlawApp);
  </script>
</dom-module>